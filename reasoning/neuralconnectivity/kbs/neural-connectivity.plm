;; $Id: neural-connectivity.plm 50 2011-06-09 22:55:52Z taruss2000@gmail.com $
;;
;;  Modules and code for the kefed neuralconnectivity application
;;


(IN-PACKAGE "STELLA")

(IN-MODULE "PL-USER")

(DEFMODULE "NEURAL-CONNECTIVITY"
    :INCLUDES ("KEFED" "NEURAL-CONNECTIVITY-LIBRARY")
    :USES ("LOGIC" "STELLA")
    :CASE-SENSITIVE? TRUE)

(DEFMODULE "EXPERIMENTS"
    :INCLUDES ("NEURAL-CONNECTIVITY")
    :USES ("LOGIC" "STELLA" "UNIT-KB")
    :CASE-SENSITIVE? TRUE)

(IN-MODULE "NEURAL-CONNECTIVITY")
(IN-DIALECT :KIF)

;;;; 
;;;;  Generated by the KEfED editor
;;;;

(DEFCONCEPT E28244A9-5EBD-719F-5446-F417C3C1A886 (?exp Experiment)
  :=> (AND (has-variable ?exp C1943801-2E3A-7211-3D35-F417C3CA814D)  ; species
           (has-variable ?exp 3A5975D7-FE69-26FD-48C8-F417C3D3014A)  ; labeling-location
           (has-variable ?exp 87428E58-04EE-BE64-D61B-F41A2B69954B)  ; injection
           (has-variable ?exp 0DE69EB2-0498-106A-96AB-F41FD86EE047)  ; labeling
           )
  :AXIOMS (AND (element-name E28244A9-5EBD-719F-5446-F417C3C1A886 "Tract-tracing Experiments II")
	       (model-source E28244A9-5EBD-719F-5446-F417C3C1A886 |Based on Gully Burns' design.|)
	       (DOCUMENTATION E28244A9-5EBD-719F-5446-F417C3C1A886 "This is a generic KEfED model for neuroanatomical tract-tracing experiments. The class of experiments that trace connectivity in the brain using tracer chemicals.  A tracer chemical is injected into a region of the brain and the areas where the chemical moves to are identified and given a labeling density score.  The density indicates the amount of chemical that has been transported to the labeling location.")))

(DEFRELATION 5FF4DB53-C895-82F1-EF38-F41AA0F89A7A (?x ?y)
  :SINGLE-VALUED TRUE
  :AXIOMS (AND (element-name 5FF4DB53-C895-82F1-EF38-F41AA0F89A7A "location")
	       (has-field 87428E58-04EE-BE64-D61B-F41A2B69954B 5FF4DB53-C895-82F1-EF38-F41AA0F89A7A)))
(DEFRELATION 556820EC-350C-EABF-6BB9-F41AC5270DB8 (?x ?y)
  :SINGLE-VALUED TRUE
  :AXIOMS (AND (element-name 556820EC-350C-EABF-6BB9-F41AC5270DB8 "chemical")
	       (has-field 87428E58-04EE-BE64-D61B-F41A2B69954B 556820EC-350C-EABF-6BB9-F41AC5270DB8)))
(DEFRELATION 977EF9A3-0DCA-3C53-0909-F4202B577761 (?x ?y)
  :SINGLE-VALUED TRUE
  :AXIOMS (AND (element-name 977EF9A3-0DCA-3C53-0909-F4202B577761 "type")
	       (has-field 0DE69EB2-0498-106A-96AB-F41FD86EE047 977EF9A3-0DCA-3C53-0909-F4202B577761)))
(DEFRELATION 8D1FC28D-2B3A-1A83-0C4C-F4205ED504F6 (?x ?y)
  :SINGLE-VALUED TRUE
  :AXIOMS (AND (element-name 8D1FC28D-2B3A-1A83-0C4C-F4205ED504F6 "density")
	       (has-field 0DE69EB2-0498-106A-96AB-F41FD86EE047 8D1FC28D-2B3A-1A83-0C4C-F4205ED504F6)))
(ASSERT (AND (Parameter-Variable C1943801-2E3A-7211-3D35-F417C3CA814D)
             (element-name C1943801-2E3A-7211-3D35-F417C3CA814D "species")
             (measures C1943801-2E3A-7211-3D35-F417C3CA814D |TTO:species|)
             (measures C1943801-2E3A-7211-3D35-F417C3CA814D |NCBITaxon:species|)
             (Parameter-Variable 3A5975D7-FE69-26FD-48C8-F417C3D3014A)
             (element-name 3A5975D7-FE69-26FD-48C8-F417C3D3014A "labeling-location")
             (Parameter-Variable 87428E58-04EE-BE64-D61B-F41A2B69954B)
             (element-name 87428E58-04EE-BE64-D61B-F41A2B69954B "injection")
             (Measurement-Variable 0DE69EB2-0498-106A-96AB-F41FD86EE047)
             (element-name 0DE69EB2-0498-106A-96AB-F41FD86EE047 "labeling")
             ;; 0DE69EB2-0498-106A-96AB-F41FD86EE047  labeling
             (depends-on 0DE69EB2-0498-106A-96AB-F41FD86EE047 C1943801-2E3A-7211-3D35-F417C3CA814D)  ; species
             (depends-on 0DE69EB2-0498-106A-96AB-F41FD86EE047 87428E58-04EE-BE64-D61B-F41A2B69954B)  ; injection
             (depends-on 0DE69EB2-0498-106A-96AB-F41FD86EE047 3A5975D7-FE69-26FD-48C8-F417C3D3014A)  ; labeling-location
             ))


;;;;
;;;; Domain specfic reasoning relations added by human curations
;;;;

(DEFCONCEPT AnterogradeTractTracingDatum  ((?datum Datum))
  :DOCUMENTATION "Tract tacing experiments where the chemical is
  transported forward along axons to target regions.  The type of
  labeling for these is 'Fiber', since the chemical moves from the
  injection site out along the fibers."
  :<= (AND (Datum ?datum)
	   (EXISTS (?datum-value)
	      (AND (datum-measurement-value ?datum 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?datum-value)
		   (977EF9A3-0DCA-3C53-0909-F4202B577761 ?datum-value Fiber)))) ; labeling-type
  )

(DEFCONCEPT RetrogradeTractTracingDatum  ((?datum Datum))
  :DOCUMENTATION "Tract tacing experiments where the chemical is
  transported forward along axons to target regions.  The type of
  labeling for these is 'Fiber', since the chemical moves from the
  injection site out along the fibers."
  :<= (AND (Datum ?datum)
	   (EXISTS (?datum-value)
	      (AND (datum-measurement-value ?datum 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?datum-value)
		   (977EF9A3-0DCA-3C53-0909-F4202B577761 ?datum-value Cell)))) ; labeling-type
  )

(DEFCONCEPT AnterogradeTractTracingExperiment  ((?exp E28244A9-5EBD-719F-5446-F417C3C1A886))
  :DOCUMENTATION "Tract tacing experiments where the chemical is
  transported forward along axons to target regions.  The type of
  labeling for these is 'Fiber', since the chemical moves from the
  injection site out along the fibers."
  :<= (AND (E28244A9-5EBD-719F-5446-F417C3C1A886 ?exp)
	   (EXISTS (?datum)
	      (AND (measurement-variable-datum ?exp 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?datum)
		   (AnterogradeTractTracingDatum ?datum)))) ; labeling-type
  )


(DEFCONCEPT RetrogradeTractTracingExperiment ((?exp E28244A9-5EBD-719F-5446-F417C3C1A886))
  :DOCUMENTATION "Tract tacing experiments where the chemical is
  transported backward along axons to their owning cells.  The type of
  labeling for these is 'Cell', since the chemical moves from the
  injection site along the axons to the cell bodies."
  :<= (AND (E28244A9-5EBD-719F-5446-F417C3C1A886 ?exp)
	   (EXISTS (?datum)
	      (AND (measurement-variable-datum ?exp 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?datum)
		   (RetrogradeTractTracingDatum ?datum))))
  )

(DEFCONCEPT Labeling-Density-Value (?density) 
  :DOCUMENTATION "Set of ordered, qualitative values that describe the
  density of labeling.  The order is specified via the `lower-density'
  relation."
  :<=> (MEMBER-OF ?density (SETOF 0 present very-sparse sparse sparse-to-moderate
				  moderate moderate-to-dense dense very-dense)))
(DEFRELATION lower-density ((?x Labeling-Density-Value) (?y Labeling-Density-Value))
  :DOCUMENTATION "Ordering relation for qualitative density values.
  If (lower-density ?x ?y), then ?x has a lower density than ?y."
  :AXIOMS (AND (TRANSITIVE lower-density)
	       (lower-density 0 present)
	       (lower-density 0 very-sparse)
	       (lower-density very-sparse sparse)
	       (lower-density sparse sparse-to-moderate)
	       (lower-density sparse-to-moderate moderate)
	       (lower-density moderate moderate-to-dense)
	       (lower-density moderate-to-dense dense)
	       (lower-density dense very-dense)))


(ASSERT (AND (Anterograde-Tracer-Chemical Tritiated-Amino-Acids)
	     ;; Lesion studies.  But they must work differently!
	     (Anterograde-Tracer-Chemical Horseradish-Peroxidase-w-Wheatgerm-Agglutinin)
	     (Anterograde-Tracer-Chemical Cholera-Toxin-w-Horseradish-Peroxidase)
	     (Anterograde-Tracer-Chemical Phaseolus-Vulgaris-Leuco-Agglutinin)))

(ASSERT (AND (Retrograde-Tracer-Chemical Horseradish-Peroxidase)
	     (Retrograde-Tracer-Chemical Horseradish-Peroxidase-w-Wheatgerm-Agglutinin) ;; both!
	     (Retrograde-Tracer-Chemical Flourescent-Dye-or-Bead)))


#|
(ASSERT (AND (DOCUMENTATION species-variable 
			    "A parameter variable that records the species of the experimental subject")
	     (DOCUMENTATION injection-variable 
			    "A parameter variable that records an injection event.  An injection event is characterized by the location and chemical used in an injection.  The location will generally be a geometric region that is related via `/PART/DIRECT-PART-OF' of `/PART/OVERLAPS' to a defined region in some atlas.")
	     (DOCUMENTATION mapped-location-variable 
			    "A parameter variable that records the location which was examined for the presence of labeling.  This will generally be a geometric region that is related via `/PART/DIRECT-PART-OF' of `/PART/OVERLAPS' to a defined region in some atlas.  There may be other areas where labeling is present, but which were not examined.")
	     (DOCUMENTATION labeling-density-variable 
			    "A measurement variable that records the density and type of labeling found in the mapped location.  Density is measured using an ordered, qualitative scale whose values come from the class `Labeling-Density-Value'.  The type  will be either `Fiber' or `Cell' depending on whether the labeling is from fibers or the cell body.")
	     ))
|#

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(DEFRELATION part-of-or-overlaps (?sub ?super)
  :DOCUMENTATION "Checks whether ?sub is contained in super, or whether ?sub overlaps
with ?super, including overlapping a part of ?super"
  :<= (OR (= ?sub ?super)
	  (/PART/PROPER-PART-OF ?sub ?super)
	  (/PART/OVERLAPS ?sub ?super)
	  (EXISTS ?overlap 
		  (AND (/PART/PROPER-PART-OF ?overlap ?super)
		       (BOUND-VARIABLES ?overlap)
		       (/PART/OVERLAPS ?sub ?overlap)))))

(DEFRELATION evidence-about-anterograde-connection (?source-region ?target-region ?density ?datum ?exp)
  :DOCUMENTATION "Returns tuples with evidence from a anterograde
experiment about a connection between ?source-region and
?target-region, with the density, datum and experiment.  This evidence
will be for any potential evidence, positive or negative for regions
that are part of or overlap potential source and target regions."
  :<= (AND (E28244A9-5EBD-719F-5446-F417C3C1A886 ?exp)
	   (BOUND-VARIABLES ?exp)
	   (EXISTS (?injection ?injection-site ?chem ?labeling ?labeling-site)
	      (AND (measurement-variable-datum ?exp 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?datum) ; labeling datum
		   (BOUND-VARIABLES ?datum)
		   (datum-context-value ?datum 87428E58-04EE-BE64-D61B-F41A2B69954B ?injection) ; injection
		   (556820EC-350C-EABF-6BB9-F41AC5270DB8 ?injection ?chem) ; chemical-fn
		   (AnterogradeTractTracingDatum ?datum)
		   ;(Anterograde-Tracer-Chemical ?chem)
		   (datum-measurement-value ?datum 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?labeling) ; labeling
		   (8D1FC28D-2B3A-1A83-0C4C-F4205ED504F6 ?labeling ?density) ; density-fn
		   (5FF4DB53-C895-82F1-EF38-F41AA0F89A7A ?injection ?injection-site) ; injection location-fn
		   (datum-context-value ?datum 3A5975D7-FE69-26FD-48C8-F417C3D3014A ?labeling-site) ; labeling-location
		   (BOUND-VARIABLES ?labeling-site ?injection-site)
		   (part-of-or-overlaps ?labeling-site ?target-region)
		   (part-of-or-overlaps ?injection-site ?source-region)
		   ;(BOUND-VARIABLES ?target-region ?source-region)
;; 		   (FAIL (/PART/PROPER-PART-OF ?source-region ?target-region)) ; Prevent going too high!
;; 		   (FAIL (/PART/PROPER-PART-OF ?target-region ?source-region))
		   ; (FAIL (= ?target-region ?source-region))
		   ))))

(DEFRELATION evidence-about-retrograde-connection (?source-region ?target-region ?density ?datum ?exp)
  :DOCUMENTATION "Returns tuples with evidence from a retrograde
experiment about a connection between ?source-region and
?target-region, with the density, datum and experiment.  This evidence
will be for any potential evidence, positive or negative for regions
that are part of or overlap potential source and target regions."
  :<= (AND (E28244A9-5EBD-719F-5446-F417C3C1A886 ?exp)
	   (BOUND-VARIABLES ?exp)
	   (EXISTS (?injection ?injection-site ?chem ?labeling ?labeling-site)
	      (AND (measurement-variable-datum ?exp 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?datum) ; labeling datum
		   (datum-context-value ?datum 87428E58-04EE-BE64-D61B-F41A2B69954B ?injection) ; injection
		   (556820EC-350C-EABF-6BB9-F41AC5270DB8 ?injection ?chem) ; chemical-fn
		   (RetrogradeTractTracingDatum ?datum)
		   ;(Retrograde-Tracer-Chemical ?chem)
		   (datum-measurement-value ?datum 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?labeling) ; labeling
		   (8D1FC28D-2B3A-1A83-0C4C-F4205ED504F6 ?labeling ?density) ; density-fn
		   (BOUND-VARIABLES ?labeling)
		   (5FF4DB53-C895-82F1-EF38-F41AA0F89A7A ?injection ?injection-site) ; injection location-fn
		   (datum-context-value ?datum 3A5975D7-FE69-26FD-48C8-F417C3D3014A ?labeling-site) ; labeling-location
		   (BOUND-VARIABLES ?labeling-site ?injection-site)
		   (part-of-or-overlaps ?labeling-site ?source-region)
		   (part-of-or-overlaps ?injection-site ?target-region)
		   ;(BOUND-VARIABLES ?target-region ?source-region)
;; 		   (FAIL (/PART/PROPER-PART-OF ?source-region ?target-region)) ; Prevent going too high!
;; 		   (FAIL (/PART/PROPER-PART-OF ?target-region ?source-region))
		   ; (FAIL (= ?target-region ?source-region))
		   ))))


(DEFRELATION evidence-about-anterograde-connection-from-regions (?source-region ?target-region ?density ?datum ?exp)
  :DOCUMENTATION "Returns tuples with evidence from a anterograde
experiment about a connection between ?source-region and
?target-region, with the density, datum and experiment.  This evidence
will be for any potential evidence, positive or negative for regions
that are part of or overlap potential source and target regions.

Optimized for the case that the regions are bound."
  :<= (AND (BOUND-VARIABLES ?source-region ?target-region)
	   (EXISTS (?injection ?injection-site ?labeling ?labeling-site)
	      (AND (part-of-or-overlaps ?labeling-site ?target-region)
		   (BOUND-VARIABLES ?labeling-site)
		   (datum-context-value ?datum 3A5975D7-FE69-26FD-48C8-F417C3D3014A ?labeling-site) ; labeling-location
		   (BOUND-VARIABLES ?datum)
		   (datum-context-value ?datum 87428E58-04EE-BE64-D61B-F41A2B69954B ?injection) ; injection
		   (5FF4DB53-C895-82F1-EF38-F41AA0F89A7A ?injection ?injection-site) ; injection location-fn
		   (BOUND-VARIABLES ?injection ?injection-site)
		   (part-of-or-overlaps ?injection-site ?source-region)
		   (AnterogradeTractTracingDatum ?datum)
		   (measurement-variable-datum ?exp 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?datum) ; labeling datum
		   (E28244A9-5EBD-719F-5446-F417C3C1A886 ?exp)
		   (datum-measurement-value ?datum 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?labeling) ; labeling
		   (8D1FC28D-2B3A-1A83-0C4C-F4205ED504F6 ?labeling ?density) ; density-fn
;; 		   (FAIL (/PART/PROPER-PART-OF ?source-region ?target-region)) ; Prevent going too high!
;; 		   (FAIL (/PART/PROPER-PART-OF ?target-region ?source-region))
		   ; (FAIL (= ?target-region ?source-region))
		   ))))

(DEFRELATION evidence-about-retrograde-connection-from-regions (?source-region ?target-region ?density ?datum ?exp)
  :DOCUMENTATION "Returns tuples with evidence from a retrograde
experiment about a connection between ?source-region and
?target-region, with the density, datum and experiment.  This evidence
will be for any potential evidence, positive or negative for regions
that are part of or overlap potential source and target regions.

Optimized for when the regions are bound."
  :<= (AND (BOUND-VARIABLES ?source-region ?target-region)
	   (EXISTS (?injection ?injection-site ?labeling ?labeling-site)
	      (AND (part-of-or-overlaps ?labeling-site ?source-region)
		   (BOUND-VARIABLES ?labeling-site)
		   (datum-context-value ?datum 3A5975D7-FE69-26FD-48C8-F417C3D3014A ?labeling-site) ; labeling-location
		   (BOUND-VARIABLES ?datum)
		   (datum-context-value ?datum 87428E58-04EE-BE64-D61B-F41A2B69954B ?injection) ; injection
		   (5FF4DB53-C895-82F1-EF38-F41AA0F89A7A ?injection ?injection-site) ; injection location-fn
		   (BOUND-VARIABLES ?injection ?injection-site)
		   (part-of-or-overlaps ?injection-site ?target-region)
		   (RetrogradeTractTracingDatum ?datum)
		   (measurement-variable-datum ?exp 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?datum) ; labeling datum
		   (E28244A9-5EBD-719F-5446-F417C3C1A886 ?exp)
		   (datum-measurement-value ?datum 0DE69EB2-0498-106A-96AB-F41FD86EE047 ?labeling) ; labeling
		   (8D1FC28D-2B3A-1A83-0C4C-F4205ED504F6 ?labeling ?density) ; density-fn
;; 		   (FAIL (/PART/PROPER-PART-OF ?source-region ?target-region)) ; Prevent going too high!
;; 		   (FAIL (/PART/PROPER-PART-OF ?target-region ?source-region))
		   ; (FAIL (= ?target-region ?source-region))
		   ))))

(DEFRELATION evidence-about-connection (?source ?target ?type ?density ?datum ?exp ?publication)
  :DOCUMENTATION "Returns tuples with evidence about a connection between
?source and ?target, with the density, datum, experiment and publication.
This evidence will be for any potential evidence, positive or negative for
regions that are part of or overlap potential source and target regions."
  :<= (AND (evidence-about-retrograde-connection ?source ?target ?density ?datum ?exp)
	   (BOUND-VARIABLES ?exp)
	   (= ?type Cell)
	   (reference-text (experiment-reference ?exp) ?publication))
  :<= (AND (evidence-about-anterograde-connection ?source ?target ?density ?datum ?exp)
	   (BOUND-VARIABLES ?exp)
	   (= ?type Fiber)
	   (reference-text (experiment-reference ?exp) ?publication))
  )

(DEFRELATION evidence-for-connection (?source ?target ?type ?density ?datum ?exp ?publication)
  :DOCUMENTATION "Returns tuples with evidence for a connection between
?source and ?target, with the density, datum, experiment and publication.
The density will not be 0 because this is evidence FOR the connection."
  :<= (AND (evidence-about-connection ?source ?target ?type ?density ?datum ?exp ?publication)
	   (NOT (= ?density 0)))
  )

(DEFRELATION evidence-against-connection (?source ?target ?type ?density ?datum ?exp ?publication)
  :DOCUMENTATION "Returns tuples with evidence against a connection between
?source and ?target, with the density, datum, experiment and publication.
The density will always be 0 because this is evidence AGAINST the connection."
  :<= (AND (= ?density 0)
	   (evidence-about-connection ?source ?target ?type ?density ?datum ?exp ?publication))
  )

(DEFRELATION evidence-about-connection-from-regions (?source ?target ?type ?density ?datum ?exp ?publication)
  :DOCUMENTATION "Returns tuples with evidence about a connection between
?source and ?target, with the density, datum, experiment and publication.
This evidence will be for any potential evidence, positive or negative for
regions that are part of or overlap potential source and target regions.

Optimized for when the regions are bound."
  :<= (AND (evidence-about-retrograde-connection-from-regions ?source ?target ?density ?datum ?exp)
	   (BOUND-VARIABLES ?exp)
	   (= ?type Cell)
	   (reference-text (experiment-reference ?exp) ?publication))
  :<= (AND (evidence-about-anterograde-connection-from-regions ?source ?target ?density ?datum ?exp)
	   (BOUND-VARIABLES ?exp)
	   (= ?type Fiber)
	   (reference-text (experiment-reference ?exp) ?publication))
  )

(DEFRELATION evidence-for-connection-from-regions (?source ?target ?type ?density ?datum ?exp ?publication)
  :DOCUMENTATION "Returns tuples with evidence for a connection between
?source and ?target, with the density, datum, experiment and publication.
The density will not be 0 because this is evidence FOR the connection.

Optimized for when the regions are bound."
  :<= (AND (evidence-about-connection-from-regions ?source ?target ?type ?density ?datum ?exp ?publication)
	   (NOT (= ?density 0)))
  )

(DEFRELATION evidence-against-connection-from-regions (?source ?target ?type ?density ?datum ?exp ?publication)
  :DOCUMENTATION "Returns tuples with evidence against a connection between
?source and ?target, with the density, datum, experiment and publication.
The density will always be 0 because this is evidence AGAINST the connection.

Optimized for when the regions are bound."
  :<= (AND (= ?density 0)
	   (evidence-about-connection-from-regions ?source ?target ?type ?density ?datum ?exp ?publication))
  )
